/*! Crocodoc Viewer - v0.4.5 | (c) 2014 Box */
var Crocodoc=function(a){var b=function(){"use strict";function a(b,d,e){var f;for(e=e||b,f=0;f<d.length;++f){if(b===d[f])throw new Error("Circular dependency detected: "+e+"->"+d[f]);c[d[f]]&&a(b,c[d[f]].mixins,e+"->"+d[f])}}var c={},d={};return{ZOOM_FIT_WIDTH:"fitwidth",ZOOM_FIT_HEIGHT:"fitheight",ZOOM_AUTO:"auto",ZOOM_IN:"in",ZOOM_OUT:"out",SCROLL_PREVIOUS:"previous",SCROLL_NEXT:"next",LAYOUT_VERTICAL:"vertical",LAYOUT_VERTICAL_SINGLE_COLUMN:"vertical-single-column",LAYOUT_HORIZONTAL:"horizontal",LAYOUT_PRESENTATION:"presentation",LAYOUT_PRESENTATION_TWO_PAGE:"presentation-two-page",PAGE_STATUS_CONVERTING:"converting",PAGE_STATUS_NOT_LOADED:"not loaded",PAGE_STATUS_LOADING:"loading",PAGE_STATUS_LOADED:"loaded",PAGE_STATUS_ERROR:"error",components:c,utilities:d,createViewer:function(a,c){return new b.Viewer(a,c)},addComponent:function(b,d,e){d instanceof Function&&(e=d,d=[]),a(b,d),c[b]={mixins:d,creator:e}},createComponent:function(a,b){var d=c[a];if(d){for(var e=[],f=0;f<d.mixins.length;++f)e.push(this.createComponent(d.mixins[f],b));return e.unshift(b),d.creator.apply(d.creator,e)}return null},addPlugin:function(a,b){this.addComponent("plugin-"+a,b)},addUtility:function(a,b){d[a]={creator:b,instance:null}},getUtility:function(a){var b=d[a];return b?(b.instance||(b.instance=b.creator(this)),b.instance):null}}}();return function(){"use strict";b.Scope=function(a){var c=b.getUtility("common"),d=[];this.createComponent=function(a){var c=b.createComponent(a,this);return c&&(c.componentName=a,d.push(c)),c},this.destroyComponent=function(a){var b,c;for(b=0,c=d.length;c>b;++b)if(a===d[b]){"function"==typeof a.destroy&&a.destroy(),d.splice(b,1);break}},this.destroy=function(){var a,b,c;for(a=0,b=d.length;b>a;++a)c=d[a],"function"==typeof c.destroy&&c.destroy();d=[]},this.broadcast=function(a,b){var e,f,g,h;for(e=0,f=d.length;f>e;++e)g=d[e],g&&(h=g.messages||[],-1!==c.inArray(a,h)&&"function"==typeof g.onmessage&&g.onmessage.call(g,a,b))},this.getUtility=function(a){return b.getUtility(a)},this.getConfig=function(){return a}}}(),function(){"use strict";function a(a,b){var c=!1;return{type:a,data:b,preventDefault:function(){c=!0},isDefaultPrevented:function(){return c}}}b.EventTarget=function(){this._handlers={}},b.EventTarget.prototype={constructor:b.EventTarget,on:function(a,b){"undefined"==typeof this._handlers[a]&&(this._handlers[a]=[]),this._handlers[a].push(b)},fire:function(b,c){var d,e,f,g=a(b,c);if(d=this._handlers[g.type],d instanceof Array)for(d=d.concat(),e=0,f=d.length;f>e;e++)d[e]&&d[e].call(this,g);if(d=this._handlers.all,d instanceof Array)for(d=d.concat(),e=0,f=d.length;f>e;e++)d[e]&&d[e].call(this,g);return g},off:function(a,b){var c,d,e=this._handlers[a];if(e instanceof Array){if(!b)return void(e.length=0);for(c=0,d=e.length;d>c;c++)if(e[c]===b||e[c].handler===b){e.splice(c,1);break}}},one:function(a,b){var c=this,d=function(e){c.off(a,d),b.call(c,e)};d.handler=b,this.on(a,d)}}}(),function(){"use strict";var c="crocodoc-text-disabled",d="crocodoc-links-disabled",e=0;b.Viewer=function(f,g){function h(a,b){n?q.broadcast(a,b):o.push({name:a,data:b})}function i(){for(var a;o.length;)a=o.shift(),q.broadcast(a.name,a.data)}function j(){n=!0,i()}b.EventTarget.call(this);var k,l=b.getUtility("common"),m=a(f),n=!1,o=[],p=l.extend(!0,{},b.Viewer.defaults,g),q=new b.Scope(p),r=q.createComponent("viewer-base");if(0===m.length)throw new Error("Invalid container element");p.id=++e,p.api=this,p.$el=m,r.init(),this.destroy=function(){q.broadcast("destroy"),q.destroy()},this.load=function(){return p.url?(/\/$/.test(p.url)||(p.url+="/"),void r.loadAssets()):void q.broadcast("fail",{error:"no URL given for assets"})},this.setLayout=function(a){k=r.setLayout(a)},this.zoom=function(a){var b=parseFloat(a);k&&(b&&(a=b/(p.pageScale||1)),k.setZoom(a))},this.scrollTo=function(a){k&&k.scrollTo(a)},this.scrollBy=function(a,b){k&&k.scrollBy(a,b)},this.focus=function(){k&&k.focus()},this.enableTextSelection=function(){p.enableTextSelection||(m.removeClass(c),p.enableTextSelection=!0,q.broadcast("textenabledchange",{enabled:!0}))},this.disableTextSelection=function(){p.enableTextSelection&&(m.addClass(c),p.enableTextSelection=!1,q.broadcast("textenabledchange",{enabled:!1}))},this.enableLinks=function(){p.enableLinks||(m.removeClass(d),p.enableLinks=!0)},this.disableLinks=function(){p.enableLinks&&(m.addClass(d),p.enableLinks=!1)},this.updateLayout=function(){k&&(k.updatePageStates(!0),k.setZoom())},this.setPageAvailable=function(a){h("pageavailable",{page:a})},this.setPagesAvailableUpTo=function(a){h("pageavailable",{upto:a})},this.setAllPagesAvailable=function(){n?q.broadcast("pageavailable",{upto:p.numPages}):p.conversionIsComplete=!0},this.one("ready",j)},b.Viewer.prototype=new b.EventTarget,b.Viewer.prototype.constructor=b.Viewer,b.Viewer.defaults={url:null,layout:b.LAYOUT_VERTICAL,zoom:b.ZOOM_AUTO,page:1,enableTextSelection:!0,enableLinks:!0,enableDragging:!1,queryParams:null,plugins:{},useWindowAsViewport:!1,conversionIsComplete:!0,template:{svg:"page-{{page}}.svg",img:"page-{{page}}.png",html:"text-{{page}}.html",css:"stylesheet.css",json:"info.json"},pageStart:null,pageEnd:null,zoomLevels:[.25,.5,.75,1,1.25,1.5,2,3]}}(),b.addUtility("ajax",function(a){"use strict";function b(a){var b,c,d;try{b=a.status,c=a.statusText,d=a.responseText}catch(e){b=0,c="",d=null}return{status:b,statusText:c,responseText:d}}function c(){if(window.XMLHttpRequest)return new window.XMLHttpRequest;try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(a){return null}}function d(a,b){return"file:"===f.parse(a).protocol&&0===b.status&&""!==b.responseText}var e=a.getUtility("common"),f=a.getUtility("url");return{request:function(a,g){function h(){e.isFn(g.success)&&g.success.call(b(k))}function i(){e.isFn(g.fail)&&g.fail.call(b(k))}g=g||{};var j=g.method||"GET",k=c();if(!f.isCrossDomain(a)||"withCredentials"in k)k?(k.open(j,a,!0),k.onreadystatechange=function(){var b;if(4===k.readyState){k.onreadystatechange=function(){};try{b=k.status}catch(c){return void i()}200===b||d(a,k)?h():i()}},k.send()):(k={status:0,statusText:"AJAX not supported"},i());else if("XDomainRequest"in window){k=new window.XDomainRequest;try{k.open(j,a),k.onload=h,k.onerror=i,k.ontimeout=i,k.onprogress=function(){},k.send()}catch(l){k={status:0,statusText:l.message},i()}}else k={status:0,statusText:"CORS not supported"},i();return k}}}),b.addUtility("browser",function(){"use strict";var a,b=navigator.userAgent,c={},d=/ip(hone|od|ad)/i.test(b),e=/android/i.test(b),f=/blackberry/i.test(b),g=/webos/i.test(b),h=/silk|kindle/i.test(b),i=/MSIE|Trident/i.test(b);return i&&(c.ie=!0,a=/MSIE/i.test(b)?/MSIE\s+(\d+\.\d+)/i.exec(b):/Trident.*rv[ :](\d+\.\d+)/.exec(b),c.version=a&&parseFloat(a[1]),c.ielt9=c.version<9,c.ielt10=c.version<10,c.ielt11=c.version<11),d&&(c.ios=!0,a=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),c.version=a&&parseFloat(a[1]+"."+a[2])),c.mobile=/mobile/i.test(b)||d||e||f||g||h,c.firefox=/firefox/i.test(b),/safari/i.test(b)&&(c.chrome=/chrome/i.test(b),c.safari=!c.chrome),c}),b.addUtility("common",function(){"use strict";var b=1.33333,c={};return c.extend=a.extend,c.each=a.each,c.map=a.map,c.parseJSON=a.parseJSON,a.extend(c,{bisectLeft:function(a,b,c){for(var d,e,f=0,g=a.length;g>f;)e=Math.floor((f+g)/2),d=c?a[e][c]:a[e],b>d?f=e+1:g=e;return f},bisectRight:function(a,b,c){for(var d,e,f=0,g=a.length;g>f;)e=Math.floor((f+g)/2),d=c?a[e][c]:a[e],d>b?g=e:f=e+1;return f},clamp:function(a,b,c){return b>a?b:a>c?c:a},sign:function(a){var b=parseInt(a,10);return b?0>b?-1:1:b},isFn:function(a){return"function"==typeof a},inArray:function(b,d){return c.isFn(d.indexOf)?d.indexOf(b):a.inArray(b,d)},constrainRange:function(a,b,d){var e=b-a;return a=c.clamp(a,0,d),b=c.clamp(a+e,0,d),e>b-a&&(a=c.clamp(b-e,0,d)),{min:a,max:b}},now:function(){return(new Date).getTime()},throttle:function(a,b){function d(){i=c.now(),g=null,h=b.apply(e,f)}var e,f,g,h,i=0;return function(){var j=c.now(),k=a-(j-i);return e=this,f=arguments,0>=k?(clearTimeout(g),g=null,i=j,h=b.apply(e,f)):g||(g=setTimeout(d,k)),h}},debounce:function(a,b){function d(){var j=c.now()-h;a>j?g=setTimeout(d,a-j):(g=null,i=b.apply(e,f),e=f=null)}var e,f,g,h,i;return function(){return e=this,f=arguments,h=c.now(),g||(g=setTimeout(d,a)),i}},insertCSS:function(a){var b=document.createElement("style"),c=document.createTextNode(a);try{b.setAttribute("type","text/css"),b.appendChild(c)}catch(d){}return document.getElementsByTagName("head")[0].appendChild(b),b},appendCSSRule:function(a,b,c){var d;return a.insertRule?a.insertRule(b+"{"+c+"}",a.cssRules.length):(d=a.addRule(b,c,a.rules.length),0>d&&(d=a.rules.length-1),d)},deleteCSSRule:function(a,b){a.deleteRule?a.deleteRule(b):a.removeRule(b)},getSelectedNode:function(){var a,b,c;return window.getSelection?(b=window.getSelection(),b.rangeCount&&(c=b.getRangeAt(0),c.collapsed||(a=b.anchorNode.parentNode))):document.selection&&(a=document.selection.createRange().parentElement()),a},getComputedStyle:function(a){return"getComputedStyle"in window?window.getComputedStyle(a):a.currentStyle},calculatePtSize:function(){var a,d,e=1e4,f=document.createElement("div");return f.style.display="block",f.style.position="absolute",f.style.width=e+"pt",document.body.appendChild(f),a=c.getComputedStyle(f),d=a&&a.width?parseFloat(a.width)/e:b,document.body.removeChild(f),d},countInStr:function(a,b){for(var c,d=0;c=a.indexOf(b,c)+1;)d++;return d},template:function(a,b){var c;for(c in b)b.hasOwnProperty(c)&&(a=a.replace(new RegExp("\\{\\{"+c+"\\}\\}","g"),b[c]));return a}})}),b.addUtility("subpx",function(b){"use strict";function c(){if(!a.support.leadingWhitespace)return!1;var b=a(f.template(e,{size:12.5})).appendTo(document.documentElement).get(0),c=a(b).css("font-size"),d=a(b).width();a(b).remove(),b=a(f.template(e,{size:12.6})).appendTo(document.documentElement).get(0);var g=a(b).css("font-size"),h=a(b).width();if(a(b).remove(),!("ontouchstart"in window)){if(c===g)return!1;if(d===h)return!1}return!0}var d="crocodoc-subpx-fix",e='<span style="font:{{size}}px serif; color:transparent; white-space:nowrap;">'+new Array(100).join("A")+"</span>",f=b.getUtility("common"),g=c();return{fix:function(b){if(!g&&void 0!==document.body.style.zoom){var c=a("<div>").addClass(d);a(b).children().wrapAll(c)}return b},isSubpxSupported:function(){return g}}}),b.addUtility("support",function(){"use strict";function a(a){var c,d,f,g=document.createElement("div");if(a in g.style)return a;if(c=a.charAt(0).toUpperCase()+a.substr(1),a in g.style)return a;for(d=0;d<e.length;++d)if(f=e[d]+c,f in g.style)return 0===f.indexOf("ms")&&(f="-"+f),b(f);return!1}function b(a){return a.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()})}var c,d,e=["Moz","Webkit","O","ms"];return function(){for(var a=0,b=["ms","moz","webkit","o"],e=0;e<b.length&&!c;++e)c=window[b[e]+"RequestAnimationFrame"],d=window[b[e]+"CancelAnimationFrame"]||window[b[e]+"CancelRequestAnimationFrame"];c||(c=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),d||(d=function(a){clearTimeout(a)})}(),{svg:document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"),csstransform:a("transform"),csstransition:a("transition"),csszoom:a("zoom"),requestAnimationFrame:function(){return c.apply(window,arguments)},cancelAnimationFrame:function(){d.apply(window,arguments)}}}),b.addUtility("url",function(a){"use strict";var b=a.getUtility("browser");return{getCurrentURL:function(){return window.location.href},makeAbsolute:function(a){return this.parse(a).href},isCrossDomain:function(a){var b=this.parse(a);return b.protocol!==window.location.protocol||b.host!==window.location.host},parse:function(a){var c,d;return a===this.getCurrentURL()?c=window.location:(c=document.createElement("a"),c.href=a,b.ie&&a!==c.href&&(a=c.href,c.href=a)),d=c.pathname,/^\//.test(d)||(d="/"+d),{href:c.href,protocol:c.protocol,host:c.host,hostname:c.hostname,port:c.port,pathname:d,hash:c.hash,search:c.search}}}}),b.addComponent("dragger",function(b){"use strict";function c(a){f.scrollTop(g.top-(a.clientY-h.y)),f.scrollLeft(g.left-(a.clientX-h.x)),a.preventDefault()}function d(a){b.broadcast("dragend"),i.off("mousemove",c),i.off("mouseup",d),a.preventDefault()}function e(a){b.broadcast("dragstart"),g={top:f.scrollTop(),left:f.scrollLeft()},h={x:a.clientX,y:a.clientY},i.on("mousemove",c),i.on("mouseup",d),a.preventDefault()}var f,g,h,i=a(window);return{init:function(b){f=a(b),f.on("mousedown",e)},destroy:function(){f.off("mousedown",e),f.off("mousemove",c),i.off("mouseup",d)}}}),b.addComponent("layout-base",function(a){"use strict";function c(a,b){var c,d,e,f,g=a.state,h="."+a.config.namespace+" ."+i,j=a.config.stylesheet,k=g.pages,l=b*a.config.pageScale,m=100/l;for(f=r.csstransform?r.csstransform+":scale("+l+");width:"+m+"%;height:"+m+"%;":r.csszoom?"zoom:"+l:"",g.previousStyleIndex&&q.deleteCSSRule(j,g.previousStyleIndex),g.previousStyleIndex=q.appendCSSRule(j,h,f),c=0,d=k.length;d>c;++c)e=k[c],a.$pages.eq(c).css({width:e.actualWidth*b,height:e.actualHeight*b,paddingTop:e.paddingTop*b,paddingRight:e.paddingRight*b,paddingBottom:e.paddingBottom*b,paddingLeft:e.paddingLeft*b})}function d(a,b){if(!b||0===b.length)return 1/0;var c=q.map(b,function(b){return a[b].y1});return Math.max.apply(Math,c)}var e="crocodoc-layout-",f="crocodoc-current-page",g="crocodoc-page-",h=g+"visible",i=g+"autoscale",j="padding-",k=j+"top",l=j+"right",m=j+"left",n=j+"bottom",o=.95,p=.99,q=a.getUtility("common"),r=a.getUtility("support");return{messages:["resize","scroll","scrollend"],onmessage:function(a,b){switch(a){case"resize":this.handleResize(b);break;case"scroll":this.handleScroll(b);break;case"scrollend":this.handleScrollEnd(b)}},init:function(){var b=a.getConfig();this.config=b,this.$el=b.$el,this.$doc=b.$doc,this.$viewport=b.$viewport,this.$pages=b.$pages,this.numPages=b.numPages,this.layoutClass=e+b.layout,this.$el.addClass(this.layoutClass),this.initState(),this.updatePageStates(),this.updateZoomLevels()},initState:function(){var a=this.$viewport[0],b=a;a===window&&(b=document.documentElement),this.state={pages:[],widestPage:{index:0,actualWidth:0},tallestPage:{index:0,actualHeight:0},sumWidths:0,sumHeights:0,rows:[],scrollTop:a.scrollTop,scrollLeft:a.scrollLeft,viewportDimensions:{clientWidth:b.clientWidth,clientHeight:b.clientHeight,offsetWidth:b.offsetWidth,offsetHeight:b.offsetHeight},zoomState:{zoom:1,prevZoom:0,zoomMode:null},currentPage:null,visiblePages:[],fullyVisiblePages:[],initialWidth:0,initialHeight:0},this.zoomLevels=[]},destroy:function(){this.$doc.removeAttr("style"),this.$pages.css("padding",""),this.$el.removeClass(this.layoutClass)},setZoom:function(c){var d,e,f=this.state,g=this.parseZoomValue(c),h=f.zoomState,i=h.zoom;d=this.calculateZoomMode(c,g),g=q.clamp(g,f.minZoom,f.maxZoom),a.broadcast("beforezoom",q.extend({page:f.currentPage,visiblePages:q.extend([],f.visiblePages),fullyVisiblePages:q.extend([],f.fullyVisiblePages)},h)),h.prevZoom=i,h.zoom=g,h.zoomMode=d,this.applyZoom(g),h.canZoomIn=this.calculateNextZoomLevel(b.ZOOM_IN)!==!1,h.canZoomOut=this.calculateNextZoomLevel(b.ZOOM_OUT)!==!1,this.updatePageStates(),this.updateLayout(),e=c===b.ZOOM_AUTO||c===b.ZOOM_FIT_WIDTH||c===b.ZOOM_FIT_HEIGHT,this.updateScrollPosition(e),this.updatePageStates(),this.updateVisiblePages(!0),a.broadcast("zoom",q.extend({page:f.currentPage,visiblePages:q.extend([],f.visiblePages),fullyVisiblePages:q.extend([],f.fullyVisiblePages),isDraggable:this.isDraggable()},h))},isDraggable:function(){var a=this.state;return a.viewportDimensions.clientHeight<a.totalHeight||a.viewportDimensions.clientWidth<a.totalWidth},parseZoomValue:function(a){var c=parseFloat(a),d=this.state,e=d.zoomState,f=e.zoom,g=f;if(c)g=c;else switch(a){case b.ZOOM_FIT_WIDTH:case b.ZOOM_FIT_HEIGHT:case b.ZOOM_AUTO:g=this.calculateZoomValue(a);break;case b.ZOOM_IN:case b.ZOOM_OUT:g=this.calculateNextZoomLevel(a)||f;break;default:g=f?e.zoomMode?this.calculateZoomValue(e.zoomMode):f:this.calculateZoomValue(this.config.zoom||b.ZOOM_AUTO)}return g},calculateZoomMode:function(a,c){switch(c){case this.calculateZoomValue(b.ZOOM_AUTO):return"string"!=typeof a||a!==b.ZOOM_FIT_WIDTH&&a!==b.ZOOM_FIT_HEIGHT?b.ZOOM_AUTO:a;case this.calculateZoomValue(b.ZOOM_FIT_WIDTH):return b.ZOOM_FIT_WIDTH;case this.calculateZoomValue(b.ZOOM_FIT_HEIGHT):return b.ZOOM_FIT_HEIGHT;default:return null}},updateZoomLevels:function(){function a(a){var b=d/a;return a===d?!1:o>b?!0:q.inArray(a,i)>-1&&p>b?!0:!1}var c,d,e=this.config.zoomLevels.slice()||[1],f=this.calculateZoomValue(b.ZOOM_AUTO),g=this.calculateZoomValue(b.ZOOM_FIT_WIDTH),h=this.calculateZoomValue(b.ZOOM_FIT_HEIGHT),i=[g,h];for(this.state.minZoom=this.config.minZoom||e[0],this.state.maxZoom=this.config.maxZoom||e[e.length-1],f!==g&&f!==h&&i.push(f),e=e.concat(i),e.sort(function(a,b){return a-b}),this.zoomLevels=[],d=0,c=0;c<e.length;++c)a(e[c])&&(d=e[c],this.zoomLevels.push(d))},calculateNextZoomLevel:function(a){var c,d=!1,e=this.state.zoomState.zoom,f=this.zoomLevels;if(a===b.ZOOM_IN){for(c=0;c<f.length;++c)if(f[c]>e){d=f[c];break}}else if(a===b.ZOOM_OUT)for(c=f.length-1;c>=0;--c)if(f[c]<e){d=f[c];break}return d},calculateZoomValue:function(a){var c=this.state,d=parseFloat(a);return d?d:a===b.ZOOM_FIT_WIDTH?c.viewportDimensions.clientWidth/c.widestPage.totalActualWidth:a===b.ZOOM_FIT_HEIGHT?c.viewportDimensions.clientHeight/c.tallestPage.totalActualHeight:a===b.ZOOM_AUTO?this.calculateZoomAutoValue():c.zoomState.zoom},applyZoom:function(a){c(this,a)},scrollTo:function(a){var c=this.state,d=parseInt(a,10);if("string"==typeof a){if(a===b.SCROLL_PREVIOUS&&c.currentPage>1)d=this.calculatePreviousPage();else if(a===b.SCROLL_NEXT&&c.currentPage<this.numPages)d=this.calculateNextPage();else if(!d)return}else if(!d&&0!==d)return;d=q.clamp(d,1,this.numPages),this.scrollToPage(d)},scrollBy:function(a,b){a=parseInt(a,10)||0,b=parseInt(b,10)||0,this.scrollToOffset(a+this.state.scrollLeft,b+this.state.scrollTop)},scrollToPage:function(a){var b=this.calculateScrollPositionForPage(a);this.scrollToOffset(b.left,b.top)},calculateCurrentPage:function(){return this.state.currentPage},calculateScrollPositionForPage:function(a){var b=q.clamp(a-1,0,this.numPages-1),c=this.state.pages[b];return{top:c.y0,left:c.x0}},calculateVisibleRange:function(){var a=this.state,b=a.scrollTop,c=b+a.viewportDimensions.clientHeight,d=a.scrollLeft,e=d+a.viewportDimensions.clientWidth,f=q.bisectLeft(a.pages,b,"y1"),g=q.bisectRight(a.pages,c,"y0")-1,h=q.bisectLeft(a.pages,d,"x1"),i=q.bisectRight(a.pages,e,"x0")-1,j=Math.max(h,f),k=Math.min(i,g);return q.constrainRange(j,k,this.numPages-1)},calculateFullyVisibleRange:function(){var a=this.state,b=a.scrollTop,c=b+a.viewportDimensions.clientHeight,d=a.scrollLeft,e=d+a.viewportDimensions.clientWidth,f=q.bisectLeft(a.pages,b,"y0"),g=q.bisectRight(a.pages,c,"y1")-1,h=q.bisectLeft(a.pages,d,"x0"),i=q.bisectRight(a.pages,e,"x1")-1,j=Math.max(h,f),k=Math.min(i,g);return q.constrainRange(j,k,this.numPages-1)},scrollToOffset:function(a,b){this.$viewport.scrollLeft(a),this.$viewport.scrollTop(b)},setCurrentPage:function(b){var c=this.state;c.currentPage!==b?(c.currentPage=b,this.updateVisiblePages(),a.broadcast("pagefocus",{page:c.currentPage,numPages:this.numPages,visiblePages:q.extend([],c.visiblePages),fullyVisiblePages:q.extend([],c.fullyVisiblePages)})):this.updateVisiblePages()},updateVisiblePages:function(a){var b,c,d,e=this.state,f=this.calculateVisibleRange(),g=this.calculateFullyVisibleRange();for(e.visiblePages.length=0,e.fullyVisiblePages.length=0,b=0,c=this.$pages.length;c>b;++b)d=this.$pages.eq(b),b<f.min||b>f.max?a&&d.hasClass(h)&&d.removeClass(h):(a&&!d.hasClass(h)&&d.addClass(h),e.visiblePages.push(b+1)),b>=g.min&&b<=g.max&&e.fullyVisiblePages.push(b+1)},updatePageStates:function(a){var b,c,e,f,g,h=this.state,i=h.pages,j=h.rows,o=this.$viewport.scrollTop(),p=this.$viewport.scrollLeft(),q=0,r=0,s=0,t=0;for(j.length=h.sumWidths=h.sumHeights=h.totalWidth=h.totalHeight=0,h.widestPage.totalActualWidth=h.tallestPage.totalActualHeight=0,b=0,c=this.$pages.length;c>b;++b)g=this.$pages.eq(b),f=g[0],e=i[b],(!e||a)&&(g.css("padding",""),e={index:b,paddingLeft:parseFloat(g.css(m)),paddingRight:parseFloat(g.css(l)),paddingTop:parseFloat(g.css(k)),paddingBottom:parseFloat(g.css(n))}),e.actualWidth||(e.actualWidth=parseFloat(f.getAttribute("data-width"))),e.actualHeight||(e.actualHeight=parseFloat(f.getAttribute("data-height"))),e.totalActualWidth=e.actualWidth+e.paddingLeft+e.paddingRight,e.totalActualHeight=e.actualHeight+e.paddingTop+e.paddingBottom,e.width=f.offsetWidth,e.height=f.offsetHeight,e.x0=f.offsetLeft,e.y0=f.offsetTop,e.x1=e.width+e.x0,e.y1=e.height+e.y0,r&&d(i,j[q])<=e.y0+2&&q++,r=e.y1,j[q]||(j[q]=[]),e.totalActualWidth>h.widestPage.totalActualWidth&&(h.widestPage=e),e.totalActualHeight>h.tallestPage.totalActualHeight&&(h.tallestPage=e),h.sumWidths+=e.width,h.sumHeights+=e.height,e.rowIndex=q,i[b]=e,j[q].push(b),i[s].x0+i[s].width<e.x0+e.width&&(s=b),i[t].y0+i[t].height<e.y0+e.height&&(t=b);h.totalWidth=i[s].x0+i[s].width,h.totalHeight=i[t].y0+i[t].height,h.scrollTop=o,h.scrollLeft=p,this.setCurrentPage(this.calculateCurrentPage())},updateCurrentPage:function(){var a=this.calculateCurrentPage();this.setCurrentPage(a)},handleResize:function(a){var b=this.state.zoomState.zoomMode;this.state.viewportDimensions=a,this.updateZoomLevels(),this.setZoom(b)},handleScroll:function(a){this.state.scrollTop=a.scrollTop,this.state.scrollLeft=a.scrollLeft},handleScrollEnd:function(a){this.$doc.find("."+f).removeClass(f),this.$pages.eq(this.state.currentPage-1).addClass(f),this.updateVisiblePages(!0),this.handleScroll(a)},updateScrollPosition:function(a){var b,c,d=this.state,e=d.zoomState,f=e.zoom/e.prevZoom;b=d.scrollLeft*f,c=d.scrollTop*f,a!==!0&&(c+=d.viewportDimensions.offsetHeight*(f-1)/2,b+=d.viewportDimensions.offsetWidth*(f-1)/2),this.scrollToOffset(b,c)},focus:function(){this.$viewport.focus()},updateLayout:function(){},calculateZoomAutoValue:function(){return 1},calculateNextPage:function(){return 1},calculatePreviousPage:function(){return 1}}}),b.addComponent("layout-"+b.LAYOUT_HORIZONTAL,["layout-base"],function(a,c){"use strict";var d=a.getUtility("common"),e=a.getUtility("browser");return d.extend({},c,{calculateZoomAutoValue:function(){var a=this.state,c=this.calculateZoomValue(b.ZOOM_FIT_WIDTH),d=this.calculateZoomValue(b.ZOOM_FIT_HEIGHT);return a.widestPage.actualWidth>a.tallestPage.actualHeight?Math.min(c,d):e.mobile?d:Math.min(1,d)},calculateCurrentPage:function(){var a,b,c=this.state,e=c.pages;return a=d.bisectRight(e,c.scrollLeft,"x0")-1,b=d.bisectRight(e,c.scrollLeft+e[a].width/2,"x0")-1,1+b},calculateNextPage:function(){return this.state.currentPage+1},calculatePreviousPage:function(){return this.state.currentPage-1},handleResize:function(a){c.handleResize.call(this,a),this.updateCurrentPage()},handleScroll:function(a){c.handleScroll.call(this,a),this.updateCurrentPage()},updateLayout:function(){var a=this.state,b=a.zoomState,c=b.zoom,d=a.sumWidths,e=Math.floor(a.tallestPage.totalActualHeight*c),f=Math.max(d,a.viewportDimensions.clientWidth),g=Math.max(e,a.viewportDimensions.clientHeight);this.$doc.css({height:g,lineHeight:g+"px",width:f})}})}),b.addComponent("layout-"+b.LAYOUT_PRESENTATION_TWO_PAGE,["layout-"+b.LAYOUT_PRESENTATION],function(a,c){"use strict";var d=a.getUtility("common");return d.extend({},c,{init:function(){this.twoPageMode=!0,c.init.call(this)},calculateNextPage:function(){return this.state.currentPage+2},calculatePreviousPage:function(){return this.state.currentPage-2},calculateZoomValue:function(a){var d=c.calculateZoomValue.call(this,a);return a===b.ZOOM_FIT_WIDTH&&(d/=2),d},scrollToPage:function(a){c.scrollToPage.call(this,a-(a+1)%2)},calculateVisibleRange:function(){var a=this.state.currentPage-1,b=a+1;return d.constrainRange(a,b,this.numPages)},calculateFullyVisibleRange:function(){return this.calculateVisibleRange()}})}),b.addComponent("layout-"+b.LAYOUT_PRESENTATION,["layout-base"],function(a,c){"use strict";var d="crocodoc-page-",e=d+"prev",f=d+"next",g=d+"before",h=d+"after",i=d+"before-buffer",j=d+"after-buffer",k="crocodoc-current-page",l=[f,h,e,g,i,j].join(" "),m=a.getUtility("common");return m.extend({},c,{init:function(){c.init.call(this),this.updatePageMargins(),this.updatePageClasses()},destroy:function(){c.destroy.call(this),this.$pages.css({margin:"",left:""}).removeClass(l)},calculateZoomAutoValue:function(){var a=this.calculateZoomValue(b.ZOOM_FIT_WIDTH),c=this.calculateZoomValue(b.ZOOM_FIT_HEIGHT);return Math.min(a,c)},calculateCurrentPage:function(){return this.state.currentPage},calculateNextPage:function(){return this.state.currentPage+1},calculatePreviousPage:function(){return this.state.currentPage-1},calculateVisibleRange:function(){var a=this.state.currentPage-1;return m.constrainRange(a,a,this.numPages)},calculateFullyVisibleRange:function(){return this.calculateVisibleRange()},setCurrentPage:function(a){var b=m.clamp(a-1,0,this.numPages);c.setCurrentPage.call(this,a),this.$doc.find("."+k).removeClass(k),this.$pages.eq(this.state.currentPage-1).addClass(k),this.updateVisiblePages(!0),this.updatePageClasses(b)},scrollToPage:function(a){this.setCurrentPage(a)},updateLayout:function(){var a,b,c,d,e,f,g,h=this.state,i=h.zoomState,j=i.zoom,k=this.currentPage||1,l=h.pages[k-1],m=this.twoPageMode?h.pages[k]:l,n=h.viewportDimensions.clientWidth,o=h.viewportDimensions.clientHeight;a=m.actualWidth,b=l.actualWidth+(this.twoPageMode?a:0),c=l.actualHeight,d=Math.floor((b+l.paddingLeft+m.paddingRight)*j),e=Math.floor(l.totalActualHeight*j),f=Math.max(d,n),g=Math.max(e,o),this.$doc.css({width:f,height:g}),this.updatePageMargins(),f>n||g>o?this.$el.addClass("crocodoc-scrollable"):this.$el.removeClass("crocodoc-scrollable")},updatePageMargins:function(){var a,b,c,d,e,f,g,h,i,j=this.state,k=j.viewportDimensions.clientWidth,l=j.viewportDimensions.clientHeight;for(a=0,b=this.$pages.length;b>a;++a)d=this.$pages.eq(a),c=j.pages[a],i=this.twoPageMode?a%2===1?c.paddingRight:c.paddingLeft:c.paddingRight+c.paddingLeft,e=(c.actualWidth+i)*j.zoomState.zoom,f=(c.actualHeight+c.paddingTop+c.paddingBottom)*j.zoomState.zoom,this.twoPageMode?(g=Math.max(0,(k-2*e)/2),a%2===1&&(g+=e)):g=(k-e)/2,h=(l-f)/2,g=Math.max(g,0),h=Math.max(h,0),d.css({marginLeft:g,marginTop:h})},updatePageClasses:function(){var a=this.$pages,b=this.state.currentPage-1,c=b+1,d=b-1,k=20;a.removeClass(l),this.twoPageMode?(c=b+2,d=b-2,a.slice(Math.max(d,0),b).addClass(e),a.slice(c,c+2).addClass(f)):(d>=0&&a.eq(d).addClass(e),c<this.numPages&&a.eq(c).addClass(f)),a.slice(0,b).addClass(g),a.slice(Math.max(0,b-k),b).addClass(i),a.slice(c).addClass(h),a.slice(c,Math.min(this.numPages,c+k)).addClass(j)}})}),b.addComponent("layout-"+b.LAYOUT_VERTICAL_SINGLE_COLUMN,["layout-"+b.LAYOUT_VERTICAL],function(a,b){"use strict";return b}),b.addComponent("layout-"+b.LAYOUT_VERTICAL,["layout-base"],function(a,c){"use strict";var d=a.getUtility("common"),e=a.getUtility("browser");return d.extend({},c,{calculateZoomAutoValue:function(){var a=this.state,c=this.calculateZoomValue(b.ZOOM_FIT_WIDTH),d=this.calculateZoomValue(b.ZOOM_FIT_HEIGHT);return a.widestPage.actualWidth>a.tallestPage.actualHeight?Math.min(1,c,d):e.mobile?c:Math.min(1,c)},calculateCurrentPage:function(){var a,b,c,e,f,g=this.state,h=g.pages;return a=d.bisectRight(h,g.scrollTop,"y0")-1,0>a?1:(f=g.scrollTop+h[a].height/2,b=d.bisectRight(h,f,"y0")-1,c=h[b].rowIndex,e=g.rows[c],1+e[0])},calculateNextPage:function(){var a=this.state,b=a.pages[a.currentPage-1],c=b.rowIndex,d=a.rows[c+1];return d&&d[0]+1||a.currentPage},calculatePreviousPage:function(){var a=this.state,b=a.pages[a.currentPage-1],c=b.rowIndex,d=a.rows[c-1];return d&&d[0]+1||a.currentPage},handleResize:function(a){c.handleResize.call(this,a),this.updateCurrentPage()},handleScroll:function(a){c.handleScroll.call(this,a),this.updateCurrentPage()},updateLayout:function(){var a,b,c=this.state,d=c.zoomState.zoom;a=Math.floor(c.widestPage.totalActualWidth*d),b=a<=c.viewportDimensions.clientWidth?"auto":a,this.$doc.css({width:b})}})}),b.addComponent("lazy-loader",function(b){"use strict";function c(a){a=a||v;var b=y.page-1,c=b-a,d=b+a;return r.constrainRange(c,d,o-1)}function d(){var a;clearTimeout(q),u.length>0?(a=u.shift(),n[a]&&n[a].errorCount<=z?t.loadPage(a,function(a){a===!1?d():q=setTimeout(d,A)}):d()):f()}function e(){clearTimeout(q),w=!1,q=setTimeout(d,A)}function f(){clearTimeout(q),w=!0}function g(a){u.push(a),w&&e()}function h(){u.length=0,f()}function i(a,b){var d=c(b);return a>=d.min&&a<=d.max?!0:!1}function j(a){var b=n[a];if(b){if(i(a))return!0;if(l(a))return!0}return!1}function k(a,b){return i(a,b)?!1:l(a)?!1:!0}function l(a){return r.inArray(a+1,y.visiblePages)>-1}function m(a,b){for(var c=r.sign(b-a);a!==b;)t.queuePageToLoad(a),a+=c;t.queuePageToLoad(a)}var n,o,p,q,r=b.getUtility("common"),s=b.getUtility("browser"),t={},u=[],v=1,w=!0,x=1,y={page:1,visiblePages:[1]},z=1,A=s.mobile||s.ielt10?100:50,B=s.mobile||s.ielt10?8:32;return r.extend(t,{messages:["beforezoom","pageavailable","pagefocus","scroll","scrollend","zoom"],onmessage:function(a,b){switch(a){case"beforezoom":this.handleBeforeZoom(b);break;case"pageavailable":this.handlePageAvailable(b);break;case"pagefocus":this.handlePageFocus(b);break;case"scroll":this.handleScroll(b);break;case"scrollend":this.handleScrollEnd(b);break;case"zoom":this.handleZoom(b)}},init:function(a){n=a,o=n.length,v=Math.min(B,o)},destroy:function(){this.cancelAllLoading()},updateLayoutState:function(a){x=r.sign(a.page-y.page),y=a},loadNecessaryPages:r.debounce(100,function(){this.cancelAllLoading(),this.queuePageToLoad(y.page-1),this.loadVisiblePages(),this.loadPagesInRange(v)}),loadPagesInRange:function(a){var b=y.page-1;a>0&&(a=c(a),x>=0?(m(b+1,a.max),m(b-1,a.min)):(m(b-1,a.min),m(b+1,a.max)))},loadVisiblePages:function(){var a,b;for(a=0,b=y.visiblePages.length;b>a;++a)this.queuePageToLoad(y.visiblePages[a]-1)},queuePageToLoad:function(a){j(a)&&(n[a].preload(),g(a))},cancelAllLoading:function(){clearTimeout(p),h()},loadPage:function(b,c){a.when(n[b]&&n[b].load()).fail(function(a){n[b].errorCount=n[b].errorCount||0,n[b].errorCount<z?u.unshift(b):n[b].fail(a),n[b].errorCount++}).always(c)},unloadPage:function(a){var b=n[a];b&&b.unload()},unloadUnnecessaryPages:function(a){var b,c;for(b=0,c=n.length;c>b;++b)k(b,a)&&this.unloadPage(b)},handlePageAvailable:function(a){var b;if(a.page)this.queuePageToLoad(a.page-1);else if(a.upto)for(b=0;b<a.upto;++b)this.queuePageToLoad(b)},handlePageFocus:function(a){this.updateLayoutState(a),this.cancelAllLoading(),p=setTimeout(function(){t.loadNecessaryPages()},200)},handleBeforeZoom:function(a){this.cancelAllLoading(),this.unloadUnnecessaryPages(2*a.visiblePages.length)},handleZoom:function(a){this.updateLayoutState(a),this.loadNecessaryPages()},handleScroll:function(){this.cancelAllLoading()},handleScrollEnd:function(){this.loadNecessaryPages(),this.unloadUnnecessaryPages(v)}})}),b.addComponent("page-img",function(b){"use strict";var c,d,e,f=b.getUtility("browser"),g=!1,h=f.mobile;return{init:function(b,c){d=a(b),e=c.imgSrc+(c.queryString||"")},destroy:function(){d.empty()},preload:function(){},load:function(){var b=a.Deferred();if(c)g||b.resolve();else{var f=new window.Image;g=!0,f.onload=function(){g=!1,b.resolve()},f.onerror=function(){c=null,b.reject({error:"failed to load image"})},f.src=e,c=a(f),d.html(c)}return c.show(),b},unload:function(){g=!1,c&&h?(c.remove(),c=null):c&&c.hide()}}}),b.addComponent("page-links",function(b){"use strict";function c(b){var c=a("<a>").addClass(f),h=b.bbox[0],i=b.bbox[1],j={};if(g.ie&&a("<span>").appendTo(c).on("click",d),c.css({left:h+"pt",top:i+"pt",width:b.bbox[2]-h+"pt",height:b.bbox[3]-i+"pt"}),b.uri){if(!/^http|^mailto/.test(b.uri))return;j.href=encodeURI(b.uri),j.target="_blank"}else b.destination&&(j.href="#page-"+b.destination.pagenum);c.attr(j),c.data("link",b),c.appendTo(e)
}function d(c){var d=g.ie?c.target.parentNode:c.target,e=a(d),f=e.data("link");f&&b.broadcast("linkclick",f),c.preventDefault()}var e,f="crocodoc-page-link",g=b.getUtility("browser");return{init:function(b,c){e=a(b),this.createLinks(c),g.ie||e.on("click","."+f,d)},destroy:function(){e.empty().off("click"),e=g=null},createLinks:function(a){var b,d;for(b=0,d=a.length;d>b;++b)c(a[b])}}}),b.addComponent("page-svg",function(b){"use strict";function c(){switch(P){case x:case D:return a("<iframe>");case C:case y:return a("<object>").attr({type:u,data:"data:"+u+";base64,"+window.btoa(w)});case z:return a('<div style="width:100%; height:100%;">');case A:return a("<object>");case B:case E:return a("<img>")}}function d(){k&&0!==k.length||(M=!1,k=c()),0===k.parent().length&&k.appendTo(l)}function e(a){var b,c,d=q.replace("&","&#38;");return b=F.countInStr(a,'xlink:href="data:image'),b>t&&(a=a.replace(/<image[\s\w-_="]*xlink:href="data:image\/[^"]{0,5120}"[^>]*>/gi,"")),a=a.replace(/href="([^"#:]*)"/g,function(a,b){return'href="'+p+b+d+'"'}),c="<style>"+N.cssText+"</style>",H.firefox&&!I.isSubpxSupported()&&(c+="<style>text { text-rendering: geometricPrecision; }</style>"),a=a.replace(/<xhtml:link[^>]*>/,c)}function f(){if(m)return m;var b=r+q,c=a.Deferred();return k?(n=G.request(b,{success:function(){if(!K){var a=this.responseText;if(!a)return void c.reject({error:"Response was empty",status:200,resource:b});a=e(a),s=a,c.resolve()}},fail:function(){K||(s=null,c.reject({error:this.statusText,status:this.status,resource:b}))}}),m=c.promise()):void c.reject({error:"Error creating SVG element",status:200,resource:b})}function g(a){var b=a.querySelectorAll("use");[].forEach.call(b,function(b){var c=b.getAttribute("xlink:href"),d=a.querySelector(c).cloneNode(),e=b.parentNode;d.removeAttribute("id"),d.setAttribute("transform",b.getAttribute("transform")),e.replaceChild(d,b)})}function h(){var a,b,c,d,e,f=k[0].contentDocument,h=k[0].contentWindow||f&&f.defaultView;switch(P){case x:H.ielt10&&(s=s.replace(/<xhtml:link.*/,"")),d=v+s,H.ielt10?f.body.innerHTML=d:(f.documentElement.innerHTML=d,H.ios&&H.version<7&&g(f)),c=f.getElementsByTagName("svg")[0];break;case D:f.documentElement.innerHTML=v;var j=f.getElementsByTagName("head")[0]||f.documentElement,l=f.createElement("script"),m="("+i+")()";l.type="text/javascript";try{l.appendChild(document.createTextNode(m))}catch(n){l.text=m}return j.insertBefore(l,j.firstChild),void("complete"===f.readyState?(h.loadSVG(s),O||(s=null)):h.onload=function(){this.loadSVG(s),O||(s=null)});case y:a=new J,b=a.parseFromString(s,u),c=f.importNode(b.documentElement,!0),f.documentElement.appendChild(c);break;case C:h.loadSVG(s),c=f.querySelector("svg");break;case z:a=new J,b=a.parseFromString(s,u),c=document.importNode(b.documentElement,!0),k.append(c);break;case A:k.attr({type:u,data:r+q}),c=k[0];break;case B:c=k[0],c.src=r+q;break;case E:c=k[0],e="data:"+u,c.src=!H.ie&&window.btoa?e+";base64,"+window.btoa(s):e+","+encodeURIComponent(s)}O||(s=null),c.setAttribute("width","100%"),c.setAttribute("height","100%")}function i(){window.loadSVG=function(a){var b=new window.DOMParser,c=b.parseFromString(a,"image/svg+xml"),d=document.importNode(c.documentElement,!0);d.setAttribute("width","100%"),d.setAttribute("height","100%"),document.body?document.body.appendChild(d):document.documentElement.appendChild(d)}}function j(a){a?(b.broadcast("asseterror",a),M=!1,m=null):(0===k.parent().length&&k.appendTo(l),k.show(),M=!0)}var k,l,m,n,o,p,q,r,s,t=1e3,u="image/svg+xml",v="<style>html,body{width:100%;height:100%;margin:0;overflow:hidden;}</style>",w='<svg version="1.1" xmlns="http://www.w3.org/2000/svg"><script><![CDATA[('+i+")()]]></script></svg>",x=1,y=2,z=3,A=4,B=5,C=6,D=7,E=8,F=b.getUtility("common"),G=b.getUtility("ajax"),H=b.getUtility("browser"),I=b.getUtility("subpx"),J=window.DOMParser,K=!1,L=!1,M=!1,N=b.getConfig(),O=H.mobile||H.ielt10,P=H.ie?E:H.firefox?E:H.safari?x:x;return{init:function(a,b){l=a,o=b,p=o.url,r=o.svgSrc,q=o.queryString||"",P=N.embedStrategy||P},destroy:function(){K=!0,this.unload(),l.empty()},preload:function(){d(),f()},load:function(){L=!1;var b=a.Deferred();return M?(j(),b.resolve()):(d(),P===A||P===B?(h(),j(),b.resolve()):f().then(function(){K||L||(h(),j(),b.resolve())}).fail(function(a){j(a),b.reject(a)}).always(function(){n=null})),b},unload:function(){L=!0,n&&n.abort&&(n.abort(),n=null,m=null),O?(k&&(k.remove(),k=null),M=!1):M&&k.hide()}}}),b.addComponent("page-text",function(b){"use strict";function c(){return s.enableTextSelection&&!m.ielt9}function d(a){var b,c;if(a&&!r){r=!0;var d=p.countInStr(a,"<div");d>l||(a=a.replace(/<link rel="stylesheet".*/,""),b=document.implementation.createHTMLDocument(""),b.getElementsByTagName("body")[0].innerHTML=a,a=null,c=document.importNode(b.querySelector("."+k),!0),g.attr("class",c.getAttribute("class")),g.html(c.innerHTML),n.fix(g))}}function e(a){b.broadcast("asseterror",a)}function f(){if(i)return i;var b=a.Deferred();return h=o.request(j,{success:function(){q||(h=null,0===this.responseText.length&&e({error:"empty response",status:this.status,resource:j}),b.resolve(this.responseText))},fail:function(){q||(h=null,e({error:this.statusText,status:this.status,resource:j}),b.resolve())}}),i=b.promise()}var g,h,i,j,k="crocodoc-page-text",l=256,m=b.getUtility("browser"),n=b.getUtility("subpx"),o=b.getUtility("ajax"),p=b.getUtility("common"),q=!1,r=!1,s=b.getConfig();return{init:function(a,b){g=a,j=b.textSrc+b.queryString},destroy:function(){q=!0,g.empty()},preload:function(){c()&&f()},load:function(){return c()?f().then(d):!1},unload:function(){h&&h.abort&&(h.abort(),h=null,i=null)},enable:function(){g.css("display","")},disable:function(){g.css("display","none")}}}),b.addComponent("page",function(c){"use strict";var d,e,f,g,h,i,j,k,l="crocodoc-page-",m=l+"loading",n=l+"error",o=l+"text",p=l+"svg",q=l+"links",r=c.getUtility("support"),s=c.getUtility("common"),t=!1;return{errorCount:0,messages:["pageavailable","textenabledchange","pagefocus","zoom"],onmessage:function(a,c){switch(a){case"pageavailable":(c.page===i+1||c.upto>i)&&k===b.PAGE_STATUS_CONVERTING&&(k=b.PAGE_STATUS_NOT_LOADED);break;case"textenabledchange":c.enabled===!0?this.enableTextSelection():this.disableTextSelection();break;case"pagefocus":case"zoom":j=h===c.page||s.inArray(h,c.visiblePages)>-1}},init:function(a,j){var l,m,n;d=a,m=a.find("."+p),l=a.find("."+o),n=a.find("."+q),j.url=j.url||"",e=c.createComponent("page-text"),f=c.createComponent(r.svg?"page-svg":"page-img"),e.init(l,j),f.init(m,j),j.enableLinks&&j.links.length&&(g=c.createComponent("page-links"),g.init(n,j.links)),k=j.status||b.PAGE_STATUS_NOT_LOADED,i=j.index,h=i+1,this.config=j},destroy:function(){this.unload()},preload:function(){k===b.PAGE_STATUS_NOT_LOADED&&(f.preload(),e.preload())},load:function(){var g,i=this;return t=!0,k===b.PAGE_STATUS_LOADED||k===b.PAGE_STATUS_LOADING?(g=e.load(),g&&"pending"!==g.state()?!1:g):k===b.PAGE_STATUS_CONVERTING?!1:(d.removeClass(n),k=b.PAGE_STATUS_LOADING,a.when(f.load(),e.load()).done(function(){t?(k=b.PAGE_STATUS_LOADED,d.removeClass(m),c.broadcast("pageload",{page:h})):i.unload()}).fail(function(){k=b.PAGE_STATUS_NOT_LOADED,d.removeClass(m)}))},fail:function(a){k=b.PAGE_STATUS_ERROR,d.addClass(n),c.broadcast("pagefail",{page:i+1,error:a})},unload:function(){t=!1,f.unload(),e.unload(),k===b.PAGE_STATUS_LOADED&&(k=b.PAGE_STATUS_NOT_LOADED,d.addClass(m),d.removeClass(n),c.broadcast("pageunload",{page:h}))},enableTextSelection:function(){e.enable(),j&&e.load()},disableTextSelection:function(){e.disable()}}}),b.addComponent("resizer",function(b){"use strict";function c(){b.broadcast("resize",{width:i,height:j,clientWidth:g,clientHeight:h,offsetWidth:i,offsetHeight:j})}function d(){l.cancelAnimationFrame(k),e(),k=l.requestAnimationFrame(d,f)}function e(){var a=f.offsetHeight,b=f.offsetWidth;a&&(a!==j||b!==i)&&(j=a,i=b,h=f.clientHeight,g=f.clientWidth,c())}var f,g,h,i,j,k,l=b.getUtility("support"),m=[""," webkit"," moz"," "].join("fullscreenchange")+"MSFullscreenChange",n=a(window),o=a(document);return{messages:["layoutchange"],onmessage:function(){j=null,e()},init:function(b){f=a(b).get(0),f===window?(f=document.documentElement,n.on("resize",e),e()):d(),o.on(m,c)},destroy:function(){o.off(m,c),n.off("resize",e),l.cancelAnimationFrame(k)}}}),b.addComponent("scroller",function(b){"use strict";function c(){return{scrollTop:j.scrollTop(),scrollLeft:j.scrollLeft()}}function d(){r=!1,w=null,clearTimeout(k),b.broadcast("scrollend",c())}function e(){r||(r=!0,b.broadcast("scrollstart",c())),clearTimeout(k),k=setTimeout(d,q),x()}function f(){s=!0,t=!1,u=!1,e()}function g(){u=!0,e()}function h(){s=!1,t=!0,v=(new Date).getTime(),u&&i()}function i(){return clearTimeout(k),null===w&&(w=(new Date).getTime()),(new Date).getTime()-w>n?void d():(x(),void(k=setTimeout(i,o)))}var j,k,l=b.getUtility("common"),m=b.getUtility("browser"),n=3e3,o=30,p=200,q=m.mobile?500:250,r=!1,s=!1,t=!1,u=!1,v=0,w=null,x=l.throttle(p,function(){b.broadcast("scroll",c())});return{init:function(b){j=a(b),j.on("scroll",e),j.on("touchstart",f),j.on("touchmove",g),j.on("touchend",h)},destroy:function(){clearTimeout(k),j.off("scroll",e),j.off("touchstart",f),j.off("touchmove",g),j.off("touchend",h)}}}),b.addComponent("viewer-base",function(c){"use strict";function d(){u.attr(C,t.metadata.version||"0.0.0"),ab.mobile&&u.addClass(K),ab.ielt9&&u.addClass(L),bb.svg&&u.addClass(M)}function e(){var a=t.metadata;t.numPages=a.numpages,t.pageStart?t.pageStart<0&&(t.pageStart=a.numpages+t.pageStart):t.pageStart=1,t.pageStart=Z.clamp(t.pageStart,1,a.numpages),t.pageEnd?t.pageEnd<0&&(t.pageEnd=a.numpages+t.pageEnd):t.pageEnd=a.numpages,t.pageEnd=Z.clamp(t.pageEnd,t.pageStart,a.numpages),t.numPages=t.pageEnd-t.pageStart+1}function f(){u.html(W),t.useWindowAsViewport?(t.$viewport=a(window),u.addClass(N)):t.$viewport=u.find("."+F),t.$doc=u.find("."+E)}function g(){var b,c,d,e,f,g,h,i,j=Z.calculatePtSize(),k=t.metadata.dimensions,l="";for(t.pageScale=Y/(k.width*j),d=t.zoomLevels[t.zoomLevels.length-1],e=3/t.pageScale;e>d;)d+=d/2,t.zoomLevels.push(d);for(k.exceptions=k.exceptions||{},b=t.pageStart-1;b<t.pageEnd;b++)c=b+1,c in k.exceptions?(f=k.exceptions[c].width,g=k.exceptions[c].height):(f=k.width,g=k.height),h=f*j,i=g*j,h*=t.pageScale,i*=t.pageScale,l+=Z.template(X,{w:h,h:i});t.$pages=a(l).appendTo(t.$doc)}function h(){var a,b,d=t.plugins||{};for(a in d)b=c.createComponent("plugin-"+a),b&&Z.isFn(b.init)&&b.init(t.plugins[a])}function i(){d(),g(),j(),l(),w=c.createComponent("lazy-loader"),w.init(t.pages),y=c.createComponent("scroller"),y.init(t.$viewport),z=c.createComponent("resizer"),z.init(t.$viewport),(!t.enableLinks||ab.ielt9)&&s.disableLinks(),s.setLayout(t.layout),c.broadcast("ready",{page:t.page||1,numPages:t.numPages})}function j(){var a,d,e,f,g,h,i=[],j=t.pageStart-1,l=t.pageEnd,m=$.makeAbsolute(t.url),n=t.conversionIsComplete?b.PAGE_STATUS_NOT_LOADED:b.PAGE_STATUS_CONVERTING,o=k();for(a=j;l>a;a++)e=m+Z.template(t.template.svg,{page:a+1}),g=m+Z.template(t.template.html,{page:a+1}),f=m+Z.template(t.template.img,{page:a+1}),h=m+t.template.css,d=c.createComponent("page"),d.init(t.$pages.eq(a-j),{index:a,url:m,imgSrc:f,svgSrc:e,textSrc:g,cssSrc:h,status:n,queryString:t.queryString,enableLinks:t.enableLinks,links:o[a],pageScale:t.pageScale}),i.push(d);t.pages=i}function k(){var a,b,c,d=t.metadata.links||[],e=[];for(a=0,b=t.metadata.numpages;b>a;++a)e[a]=[];for(a=0,b=d.length;b>a;++a)c=d[a],e[c.pagenum-1].push(c);return e}function l(){a(document).on("mouseup",n)}function m(a){var b=s.fire("linkclick",a);b.isDefaultPrevented()||(a.uri?window.open(a.uri):a.destination&&s.scrollTo(a.destination.pagenum))}function n(){p()}function o(b,d){function e(a){c.broadcast("asseterror",a),d?o(b,!1).then(function(a){f.resolve(a)}).fail(function(a){f.reject(a)}):f.reject(a)}var f=a.Deferred();return _.request(b,{success:function(){return cb?void 0:this.responseText?void f.resolve(this.responseText):void e({error:"empty response",status:this.status,resource:b})},fail:function(){cb||e({error:this.statusText,status:this.status,resource:b})}}),f.promise()}function p(){var b=Z.getSelectedNode(),c=a(b).closest("."+O);u.find("."+J).removeClass(J),b&&u.has(b)&&c.addClass(J)}function q(a){a?A||(u.addClass(H),A=c.createComponent("dragger"),A.init(t.$viewport)):A&&(u.removeClass(H),c.destroyComponent(A),A=null)}function r(){var b;t.queryParams&&(b="string"==typeof t.queryParams?t.queryParams.replace(/^\?/,""):a.param(t.queryParams)),t.queryString=b?"?"+b:""}var s,t,u,v,w,x,y,z,A,B="crocodoc-",C="data-svg-version",D=B+"viewer",E=B+"doc",F=B+"viewport",G=B+"viewer-logo",H=B+"draggable",I=B+"dragging",J=B+"text-selected",K=B+"mobile",L=B+"ielt9",M=B+"supports-svg",N=B+"window-as-viewport",O=B+"page",P=O+"-inner",Q=O+"-content",R=O+"-svg",S=O+"-text",T=O+"-links",U=O+"-autoscale",V=O+"-loading",W='<div tabindex="-1" class="'+F+'"><div class="'+E+'"></div></div><div class="'+G+'"></div>',X='<div class="'+O+" "+V+'" style="width:{{w}}px; height:{{h}}px;" data-width="{{w}}" data-height="{{h}}"><div class="'+P+'"><div class="'+Q+'"><div class="'+R+'"></div><div class="'+U+'"><div class="'+S+'"></div><div class="'+T+'"></div></div></div></div></div>',Y=1024,Z=c.getUtility("common"),$=c.getUtility("url"),_=c.getUtility("ajax"),ab=c.getUtility("browser"),bb=c.getUtility("support"),cb=!1;return{messages:["asseterror","destroy","dragend","dragstart","fail","linkclick","pagefail","pagefocus","pageload","pageunload","ready","resize","scrollstart","scrollend","zoom"],onmessage:function(a,b){switch(a){case"linkclick":m(b);break;case"zoom":b.zoom*=t.pageScale,b.prevZoom*=t.pageScale,t.enableDragging&&q(b.isDraggable),s.fire(a,b);break;case"dragstart":u.hasClass(I)||u.addClass(I),s.fire(a,b);break;case"dragend":u.hasClass(I)&&u.removeClass(I),s.fire(a,b);break;default:s.fire(a,b)}},init:function(){t=c.getConfig(),s=t.api,t.namespace=D+"-"+t.id,u=t.$el,u.addClass(D),u.addClass(t.namespace),f(),h()},destroy:function(){a(document).off("mouseup",n),u.empty().removeClass(function(a,b){var c=b.match(new RegExp("crocodoc\\S+","g"));return c&&c.join(" ")}),a(v).remove(),cb=!0},setLayout:function(a){var b,d=t.page,e=t.zoom||1;if(x){if(a===t.layout)return x;d=x.state.currentPage,e=x.state.zoomState}if(b=c.createComponent("layout-"+a),!b)throw new Error("Invalid layout "+a);x&&c.destroyComponent(x);var f=t.layout;return t.layout=a,x=b,x.init(),x.setZoom(e.zoomMode||e.zoom||e),x.scrollTo(d),t.currentLayout=x,c.broadcast("layoutchange",{previousLayout:f,layout:a}),x},loadAssets:function(){var b,d,f=$.makeAbsolute(t.url),g=f+t.template.css,h=f+t.template.json;r(),g+=t.queryString,h+=t.queryString,d=o(h,!0),d.then(function(b){t.metadata=a.parseJSON(b),e()}),ab.ielt9?(v=Z.insertCSS(""),t.stylesheet=v.styleSheet,b=a.when()):(b=o(g,!0),b.then(function(a){ab.ie&&(a=a.replace(/font-family:[\s\"\']*([\w-]+)\b/g,"$0-"+t.id)),t.cssText=a,v=Z.insertCSS(a),t.stylesheet=v.sheet})),a.when(d,b).fail(function(a){c.broadcast("fail",a)}).then(i)}}}),b}(jQuery);